@model IEnumerable<Book>
@{
    ViewBag.Title = "書籍管理 (.NET Core 8)";
    Layout = "_Layout";
}

<h2>書籍管理</h2>

<h3>新增書籍</h3>
<form asp-controller="Book" asp-action="Add" method="post" class="mb-4">
    @Html.AntiForgeryToken()
    <div class="mb-3">
        <label class="form-label">書名</label>
        <input name="title" class="form-control" style="max-width:400px" required />
    </div>
    <div class="mb-3">
        <label class="form-label">描述</label>
        <textarea name="description" class="form-control" style="max-width:400px;height:80px"></textarea>
    </div>
    <div class="mb-3">
        <label class="form-label">位置 (例如: A-12)</label>
        <input name="position" class="form-control" style="max-width:200px" />
    </div>
    <button type="submit" class="btn btn-primary">新增書籍</button>
</form>

<hr />

<h3>查詢書籍 (可用位置 / 書名 / 關鍵字)</h3>
<div>
    <input id="q_query" placeholder="向量比對 (關鍵字)" style="width:300px" />
    <input id="q_position" placeholder="位置 (精確查) e.g. A-12" style="width:150px" />
    <input id="q_title" placeholder="書名 (模糊查)" style="width:200px" />
    <button id="btnSearch">搜尋</button>
</div>

<div id="resultArea" style="margin-top:20px"></div>

<hr />

<h3>目前書籍</h3>
<table border="1" cellpadding="4" cellspacing="0">
    <tr class="text-center">
        <th>ID</th>
        <th>Title</th>
        <th>Description</th>
        <th>Position</th>
    </tr>
    @foreach (var b in Model)
    {
        <tr>
            <td>@b.BookId</td>
            <td>@b.Title</td>
            <td>@b.Description</td>
            <td>@b.Position</td>
        </tr>
    }
</table>

@section Scripts {
    <script>
        $(function() {
            $('#btnSearch').click(function() {
                var q = $('#q_query').val();
                var p = $('#q_position').val();
                var t = $('#q_title').val();
                
                $.post('@Url.Action("Search", "Book")', { 
                    query: q, 
                    position: p, 
                    title: t,
                    __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val()
                }, function(html) {
                    $('#resultArea').html(html);
                }).fail(function() {
                    $('#resultArea').html('<div class="alert alert-danger">搜尋時發生錯誤</div>');
                });
            });
        });
    </script>
}
